{"version":3,"sources":["LoginStore.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA,IAAI,IAAI,QAAQ,QAAR,CAAR;;AAEA,IAAM,aAAa,iBAAO,WAAP,CAAmB;AACpC,eAAa,KADuB;;AAGpC,YAAU,EAH0B;;AAKpC,mBAAiB,EALmB;;AAOpC,sBAAoB,EAPgB;;AASpC,oCAToC;;AAWpC,QAXoC,oBAW5B;AAAA;;AACN,MAAE,IAAF,CAAO;AACL,WAAK,6BADA;AAEL,cAAQ,MAFH;AAGL,eAAS,iBAAC,IAAD,EAAS;AAChB,cAAK,WAAL,GAAmB,IAAnB;AACA,cAAK,QAAL,GAAgB,KAAK,QAArB;AACA,8BAAQ,UAAR;AACD,OAPI;AAQL,aAAO,iBAAK;AACV,cAAK,QAAL,GAAc,YAAW,CAAC,EAAE,KAAK,MAAL,CAAY,CAAZ,IAAe,IAAjB,CAA1B;AACA,8BAAQ,UAAR;AACD;AAXI,KAAP;AAaD,GAzBmC;AA2BpC,SA3BoC,mBA2B3B,QA3B2B,EA2BjB,QA3BiB,EA2BR;AAAA;;AAC1B,MAAE,IAAF,CAAO;AACL,WAAK,6BADA;AAEL,cAAQ,MAFH;AAGL,YAAM,EAAC,UAAU,QAAX,EAAqB,UAAU,QAA/B,EAHD;AAIL,eAAS,iBAAC,IAAD,EAAS;AAChB,eAAK,WAAL,GAAmB,IAAnB;AACA,eAAK,QAAL,GAAgB,KAAK,QAArB;AACA,8BAAQ,UAAR;AACA,oCAAe,IAAf,CAAoB,GAApB;AACD,OATI;AAUL,aAAO,iBAAK;AACV,eAAK,WAAL,GAAmB,KAAnB;AACA,8BAAQ,UAAR;AACD;AAbI,KAAP;AAeD,GA3CmC;AA6CpC,YA7CoC,sBA6CzB,QA7CyB,EA6Cf,QA7Ce,EA6CN;AAAA;;AAC5B,MAAE,IAAF,CAAO;AACL,WAAK,gCADA;AAEL,cAAQ,MAFH;AAGL,YAAM;AACJ,kBAAU,QADN;AAEJ,kBAAU;AAFN,OAHD;AAOL,eAAS,mBAAK;AACZ,oCAAe,IAAf,CAAoB,GAApB;AACD,OATI;AAUL,aAAO,eAAC,IAAD,EAAS;AACd,YAAI,aAAa,KAAK,YAAtB;AACA,YAAI,cAAc,UAAlB,EAA8B;AAC5B,iBAAK,OAAL,CAAa,EAAC,QAAQ,OAAT,EAAb;AACD,SAFD,MAEO,IAAI,cAAc,OAAlB,EAA2B;AAChC,iBAAK,OAAL,CAAa,EAAC,QAAQ,QAAT,EAAb;AACD;AACF;AAjBI,KAAP;AAmBD,GAjEmC;AAmEpC,UAnEoC,sBAmEzB;AAAA;;AACT,MAAE,IAAF,CAAO;AACL,WAAK,8BADA;AAEL,cAAQ,KAFH;AAGL,eAAS,mBAAK;AACZ,eAAK,WAAL,GAAiB,KAAjB;AACA,eAAK,QAAL,GAAc,YAAW,CAAC,EAAE,KAAK,MAAL,CAAY,CAAZ,IAAe,IAAjB,CAA1B;AACA,8BAAQ,UAAR;AACD,OAPI;AAQL,cAAQ,kBAAK;AACX,cAAM,gBAAN;AACD;AAVI,KAAP;AAYD,GAhFmC;AAkFpC,iBAlFoC,6BAkFlB;AACf,SAAK,OAAL,CAAa,EAAC,QAAO,EAAR,EAAb;AACF,GApFmC;AAsFpC,cAtFoC,0BAsFtB;AACZ,SAAK,OAAL,CAAa;AACX,mBAAY,KAAK,WADN;AAEX,gBAAS,KAAK;AAFH,KAAb;AAID;AA3FmC,CAAnB,CAAnB;;kBA+Fe,U","file":"LoginStore-compiled.js","sourcesContent":["import reflux from 'reflux';\nimport actions from '../actions/LoginAction';\nimport {browserHistory} from 'react-router';\n\nlet $ = require('jquery');\n\nconst LoginStore = reflux.createStore({\n  login_state: false,\n\n  username: '',\n\n  login_error_msg: '',\n\n  register_error_msg: '',\n\n  listenables: actions,\n\n  onInit(){\n    $.ajax({\n      url: 'http://localhost:3000/login',\n      method: 'POST',\n      success: (data)=> {\n        this.login_state = true;\n        this.username = data.username;\n        actions.triggerall();\n      },\n      error: ()=> {\n        this.username='(游客)CR-'+(~~(Math.random(1)*10e9));\n        actions.triggerall();\n      }\n    });\n  },\n\n  onLogin (username, password){\n    $.ajax({\n      url: 'http://localhost:3000/login',\n      method: 'POST',\n      data: {username: username, password: password},\n      success: (data)=> {\n        this.login_state = true;\n        this.username = data.username;\n        actions.triggerall();\n        browserHistory.push('/')\n      },\n      error: ()=> {\n        this.login_state = false;\n        actions.triggerall();\n      }\n    });\n  },\n\n  onRegister(username, password){\n    $.ajax({\n      url: 'http://localhost:3000/register',\n      method: 'POST',\n      data: {\n        username: username,\n        password: password\n      },\n      success: ()=> {\n        browserHistory.push('/')\n      },\n      error: (data)=> {\n        var errMessage = data.responseText;\n        if (errMessage == 'wrongful') {\n          this.trigger({errMsg: '输入不合法'})\n        } else if (errMessage == 'exist') {\n          this.trigger({errMsg: '用户名已存在'})\n        }\n      }\n    });\n  },\n\n  onLogout (){\n    $.ajax({\n      url: 'http://localhost:3000/logout',\n      method: 'GET',\n      success: ()=> {\n        this.login_state=false;\n        this.username='(游客)CR-'+(~~(Math.random(1)*10e9));\n        actions.triggerall();\n      },\n      failed: ()=> {\n        alert('logout failed!');\n      }\n    });\n  },\n\n  onRegistererror (){\n     this.trigger({errMsg:''});\n  },\n\n  onTriggerall(){\n    this.trigger({\n      login_state:this.login_state,\n      username:this.username\n    });\n  }\n\n});\n\nexport default LoginStore;\n"]}